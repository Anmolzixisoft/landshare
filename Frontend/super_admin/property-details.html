<!DOCTYPE html>
<html lang="en">


<head>
  <!-- Required meta tags -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@10/dist/sweetalert2.min.css">

  <!--favicon-->
  <link rel="icon" href="../assets/images/favicon-32x32.png" type="image/png" />
  <!--plugins-->
  <link href="../assets/plugins/vectormap/jquery-jvectormap-2.0.2.css" rel="stylesheet" />
  <link href="../assets/plugins/simplebar/css/simplebar.css" rel="stylesheet" />
  <link href="../assets/plugins/perfect-scrollbar/css/perfect-scrollbar.css" rel="stylesheet" />
  <link href="../assets/plugins/metismenu/css/metisMenu.min.css" rel="stylesheet" />
  <!-- loader-->
  <link href="../assets/css/pace.min.css" rel="stylesheet" />
  <script src="../assets/js/pace.min.js"></script>
  <!-- Bootstrap CSS -->
  <link href="../assets/css/bootstrap.min.css" rel="stylesheet" />
  <link href="../assets/css/bootstrap-extended.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet" />
  <link href="../assets/css/app.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link href="../assets/css/icons.css" rel="stylesheet" />
  <!-- Theme Style CSS -->
  <link rel="stylesheet" href="../assets/css/dark-theme.css" />
  <link rel="stylesheet" href="../assets/css/semi-dark.css" />
  <link rel="stylesheet" href="../assets/css/style.css" />
  <link rel="stylesheet" href="../assets/css/header-colors.css" />
  <link rel="stylesheet" href="../assets/css/responsive.css" />
  <title>Landshare -Admin Panel</title>
</head>

<body>
  <script>
    let checkAdmintoken = localStorage.getItem('admintoken')
    if (checkAdmintoken == null) {
      location = "https://landshareindia.com/web/super_admin/"
    }
    function Logout() {
      const adminToken = localStorage.getItem('admintoken');
      if (adminToken != null) {
        localStorage.removeItem('admintoken');
        window.location.href = 'http://localhost:5500/Frontend/super_admin'; // Redirect example
      }
    }
  </script>
  <!--wrapper-->
  <div class="wrapper">
    <!--sidebar wrapper -->
    <div class="sidebar-wrapper" data-simplebar="true">
      <div class="sidebar-header">
        <div>
          <h4 class="logo-text text-center">Landshare</h4>
        </div>
        <div class="toggle-icon ms-auto">
          <i class="bx bx-arrow-back"></i>
        </div>
      </div>
      <!--navigation-->
      <ul class="metismenu" id="menu">
        <li class="menu-label">Main</li>
        <li>
          <a href="./dashboard.html">
            <div class="parent-icon">
              <img src="../assets/images/dashboardicon.png" alt="" />
            </div>
            <div class="menu-title">Dashboard</div>
          </a>
        </li>

        <li class="menu-label">Users</li>
        <li>
          <a href="manage-users.html">
            <div class="parent-icon">
              <img src="../assets/images/tssicon.png" alt="" />
            </div>
            <div class="menu-title">List Users</div>
          </a>
        </li>
        <li>
          <a href="request-user.html">
            <div class="parent-icon">
              <img src="../assets/images/tssicon.png" alt="" />
            </div>
            <div class="menu-title">Request User Update </div>
          </a>
        </li>
        <li class="menu-label">Property</li>
        <!-- <li>
          <a href="new-enquiries.html">
            <div class="parent-icon">
              <img src="../assets/images/stocktrnsfericon.png" alt="" />
            </div>
            <div class="menu-title">Manage Property</div>
          </a>
        </li> -->
        <li>
          <a href="list-property.html">
            <div class="parent-icon">
              <img src="../assets/images/stocktrnsfericon.png" alt="" />
            </div>
            <div class="menu-title">List Property</div>
          </a>
        </li>
        <li>
          <a href="new-property.html">
            <div class="parent-icon">
              <img src="../assets/images/stocktrnsfericon.png" alt="" />
            </div>
            <div class="menu-title">New Property</div>
          </a>
        </li>

        <li>
          <a href="appreov-property.html">
            <div class="parent-icon">
              <img src="../assets/images/stocktrnsfericon.png" alt="" />
            </div>
            <div class="menu-title">ApprovedÂ Property</div>
          </a>
        </li>
        <li>
          <a href="reject-propert.html">
            <div class="parent-icon">
              <img src="../assets/images/stocktrnsfericon.png" alt="" />
            </div>
            <div class="menu-title">Rejected Property</div>
          </a>
        </li>
        <li>
          <a href="sold-propert.html">
            <div class="parent-icon">
              <img src="../assets/images/stocktrnsfericon.png" alt="" />
            </div>
            <div class="menu-title">Sold Property</div>
          </a>
        </li>
        <li>
          <a href="my-profile.html">
            <div class="parent-icon">
              <img src="../assets/images/stocktrnsfericon.png" alt="" />
            </div>
            <div class="menu-title">My Profile</div>
          </a>
        </li>
        <li>
          <a href="new-enquiries.html">
            <div class="parent-icon">
              <img src="../assets/images/stocktrnsfericon.png" alt="" />
            </div>
            <div class="menu-title">New Enquiries</div>
          </a>
        </li>
        <!-- <li>
          <a href="new-enquiries.html">
            <div class="parent-icon">
              <img src="../assets/images/stocktrnsfericon.png" alt="" />
            </div>
            <div class="menu-title">New Logins</div>
          </a>
        </li>
        <li>
          <a href="new-enquiries.html">
            <div class="parent-icon">
              <img src="../assets/images/stocktrnsfericon.png" alt="" />
            </div>
            <div class="menu-title">New Uploads</div>
          </a>
        </li>


        <li>
          <a href="new-enquiries.html">
            <div class="parent-icon">
              <img src="../assets/images/stocktrnsfericon.png" alt="" />
            </div>
            <div class="menu-title">IN Review Property</div>
          </a>
        </li> -->
      </ul>
      <!--end navigation-->
    </div>
    <!--end sidebar wrapper -->
    <!--start header -->
    <header>
      <div class="topbar d-flex align-items-center">
        <nav class="navbar navbar-expand gap-3">
          <div class="mobile-toggle-menu"><i class="bx bx-menu"></i></div>

          <div class="position-relative search-bar d-lg-block d-none">
            <input class="form-control px-5" type="search" placeholder="Search" />
            <span class="position-absolute top-50 search-show ms-3 translate-middle-y start-0 top-50 fs-5"><i
                class="bx bx-search"></i></span>
          </div>

          <div class="top-menu ms-auto">
            <ul class="navbar-nav align-items-center gap-1">
              <li class="nav-item mobile-search-icon d-flex d-lg-none" data-bs-toggle="modal"
                data-bs-target="#SearchModal">
                <a class="nav-link" href="avascript:;"><i class="bx bx-search"></i>
                </a>
              </li>
            </ul>
          </div>
          <div class="top-menu ms-auto">
            <ul class="navbar-nav align-items-center gap-1">
              <li class="nav-item mobile-search-icon d-flex d-lg-none" data-bs-toggle="modal"
                data-bs-target="#SearchModal">
                <a class="nav-link" href="avascript:;"><i class="bx bx-search"></i>
                </a>
              </li>

              <li class="nav-item dropdown dropdown-large">
                <a class="nav-link dropdown-toggle dropdown-toggle-nocaret position-relative" href="#"
                  data-bs-toggle="dropdown"><span class="alert-count">7</span>
                  <i class="bx bx-bell"></i>
                </a>
                <div class="dropdown-menu dropdown-menu-end">
                  <a href="javascript:;">
                    <div class="msg-header">
                      <!-- <p class="msg-header-title">Notifications</p>
                      <p class="msg-header-badge">8 New</p> -->
                    </div>
                  </a>
                  <div class="header-notifications-list">

                  </div>

                </div>
              </li>
              <li class="nav-item dropdown dropdown-large">
                <a class="nav-link dropdown-toggle dropdown-toggle-nocaret position-relative" href="#" role="button"
                  data-bs-toggle="dropdown" aria-expanded="false">
                  <span class="alert-count">8</span>
                  <i class="bx bx-shopping-bag"></i>
                </a>
                <div class="dropdown-menu dropdown-menu-end">

                  <div class="header-message-list">
                    <a class="dropdown-item" href="javascript:;">
                      <div class="d-flex align-items-center gap-3">
                        <div class="position-relative">
                          <div class="cart-product rounded-circle bg-light">
                            <img src="../assets/images/products/11.png" class="" alt="product image" />
                          </div>
                        </div>
                        <div class="flex-grow-1">
                          <h6 class="cart-product-title mb-0">
                            Men White T-Shirt
                          </h6>
                          <p class="cart-product-price mb-0">1 X $29.00</p>
                        </div>
                        <div class="">
                          <p class="cart-price mb-0">$250</p>
                        </div>
                        <div class="cart-product-cancel">
                          <i class="bx bx-x"></i>
                        </div>
                      </div>
                    </a>





                  </div>

                </div>
              </li>
            </ul>
          </div>
          <div class="user-box dropdown px-3">
            <a class="d-flex align-items-center nav-link dropdown-toggle gap-3 dropdown-toggle-nocaret" href="#"
              role="button" data-bs-toggle="dropdown" aria-expanded="false">
              <img id="blah1" src="" class="user-img" alt="user avatar" onclick="openMyProfile()" />
              <div class="user-info">
                <p class="user-name mb-0">Admin</p>
                <!-- <p class="designattion mb-0">Web Designer</p> -->
              </div>
            </a>
            <ul class="dropdown-menu dropdown-menu-end">
              <li>
                <a class="dropdown-item d-flex align-items-center" href="javascript:;" onclick="Logout()"><i
                    class="bx bx-log-out-circle"></i><span>Logout</span></a>
              </li>
            </ul>
          </div>
        </nav>
      </div>
    </header>
    <!--end header -->
    <!--start page wrapper -->
    <div class="page-wrapper">
      <div class="page-content">
        <div class="row">
          <div class="col-md-12">
            <div class="inv-box">
              <h4>Property</h4>
              <div class="manage-flex">
                <h5>Property Details</h5>
              </div>
            </div>
          </div>
          <div class="col-md-12">
            <div class="page-cnt">
              <div class="card">
                <div class="card-body">
                  <div class="container-fluid">
                    <div class="row" id="property-listings">

                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!--end page wrapper -->
    <!--start overlay-->
    <div class="overlay toggle-icon"></div>
    <!--end overlay-->
    <!--Start Back To Top Button-->
    <a href="javaScript:;" class="back-to-top"><i class="bx bxs-up-arrow-alt"></i></a>
    <!--End Back To Top Button-->
    <footer class="page-footer">
      <p class="mb-0">Copyright Â© 2023. All right reserved.</p>
    </footer>
  </div>

  <script src="../assets/js/bootstrap.bundle.min.js"></script>
  <!--plugins-->
  <script src="../assets/js/jquery.min.js"></script>
  <script src="../assets/plugins/simplebar/js/simplebar.min.js"></script>
  <script src="../assets/plugins/metismenu/js/metisMenu.min.js"></script>
  <script src="../assets/plugins/perfect-scrollbar/js/perfect-scrollbar.js"></script>
  <script src="../assets/plugins/vectormap/jquery-jvectormap-2.0.2.min.js"></script>
  <script src="../assets/plugins/vectormap/jquery-jvectormap-world-mill-en.js"></script>
  <script src="../assets/plugins/chartjs/js/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/jquery.magnific-popup.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

  <script src="../assets/js/index.js"></script>
  <!--app JS-->
  <script src="../../Frontend/utils.js"></script>
  <script src="../assets/js/app.js"></script>
  <script>
    new PerfectScrollbar(".app-container");
  </script>
  <script src="../utils.js"></script>
  <script>
    $(document).ready(function () {
      $(".image-popup-vertical-fit").magnificPopup({
        type: "image",
        mainClass: "mfp-with-zoom",
        gallery: {
          enabled: true,
        },

        zoom: {
          enabled: true,

          duration: 300,
          easing: "ease-in-out",

          opener: function (openerElement) {
            return openerElement.is("img")
              ? openerElement
              : openerElement.find("img");
          },
        },
      });
    });



    function getQueryParameter(name) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(name);
    }


    function displayPropertyDetails() {
      const propertyId = getQueryParameter("id");
      if (propertyId) {

        const userData = {
          id: propertyId
        };

        fetch(apiUrl + '/getPropertyById', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(userData)
        })
          .then(response => response.json())
          .then(data => {
            let tableContent = '<table>';

            const propertyListing = createPropertyListing(data.message[0]);
            // propertyListingsContainer.appendChild(propertyListing);

          })
          .catch(error => {
            console.log(error, '000');
            // alert(`${error}`);
          });

      } else {
        // Handle the case where no property ID is provided
        console.error('No property ID provided in the query parameter.');
      }
    }
    function changestatus(id, status) {
      let propertyId = id
      let statusdata = status
      const userData = {
        propertyId: propertyId,
        status: statusdata

      };

      fetch(apiUrl + '/updatestatus', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(userData)
      })
        .then(response => response.json())
        .then(data => {
          if (data.message) {
            Swal.fire({
              icon: 'success',
              title: 'Success',
              text: data.message,
            }).then(() => {
              location.reload()
            })
          } else {
            Swal.fire({
              icon: 'error',
              title: 'Error',
              text: data.error,
            });
          }
        })
        .catch(error => {
          Swal.fire({
            icon: 'error',
            title: 'Error',
            text: error,
          });
        });


    }


    function deleteElement(propertyId, userId) {
      var api = apiUrl + '/delete_proprty';

      var data = {
        propertyId: propertyId,
        user_id: userId
      };

      $.ajax({
        type: 'POST',
        url: api,
        contentType: 'application/json',
        data: JSON.stringify(data)
      }).done(function (responseData) {
        if (responseData.message) {
          Swal.fire({
            icon: 'success',
            title: 'Success',
            text: responseData.message
          }).then(function () {
            location.reload();
          });
        } else {
          Swal.fire({
            icon: 'error',
            title: 'Error',
            text: responseData.error
          });
        }
      }).fail(function (error) {
        Swal.fire({
          icon: 'error',
          title: 'Error',
          text: error
        });
      });
    }
    function createPropertyListing(property) {

      console.log(property);
      let approveButtonHTML = '';
      let disapproveButtonHTML = '';
      let latestEncumbranceHtml = '';
      let latestKhata_Extract = '';

      if (property.Latest_Encumbrance != null) {
        const partsLatest_Encumbrance = property.Latest_Encumbrance.split(".");
        // Get the last part of the URL (after the last dot), which is the file extension
        const extension_Latest_Encumbrance = partsLatest_Encumbrance[partsLatest_Encumbrance.length - 1];

        if (extension_Latest_Encumbrance === 'pdf') {
          latestEncumbranceHtml = `<embed src="${property.Latest_Encumbrance}" type="application/pdf" width="100%" height="300px" />`
        } else {
          latestEncumbranceHtml = `<a class="image-popup-vertical-fit" href=${property.Latest_Encumbrance}>
                      <img src=${property.Latest_Encumbrance}  />
                  </a>`
        }
      } else {
        latestEncumbranceHtml = "Not Uploaded"
      }

      if (property.Khata_Extract != null) {
        const partsKhata_Extract = property.Khata_Extract.split(".");
        // Get the last part of the URL (after the last dot), which is the file extension
        const extension_Khata_Extract = partsKhata_Extract[partsKhata_Extract.length - 1];

        if (extension_Khata_Extract === 'pdf') {
          latestKhata_Extract = `<embed src="${property.Khata_Extract}" type="application/pdf" width="100%" height="300px" />`
        } else {
          latestKhata_Extract = `<a class="image-popup-vertical-fit" href=${property.Khata_Extract}>
                      <img src=${property.Khata_Extract} />
                  </a>`
        }
      } else {
        latestKhata_Extract = "Not Uploaded"
      }

      if (property.property_status == 0) {
        // Property is approved
        approveButtonHTML = '<button class="delvr-button" onclick="changestatus(' + property.id + ', 1)">Approve</button>';
      } else if (property.property_status == 1) {
        // Property is disapproved
        disapproveButtonHTML = '<button class="nondelvr-button" onclick="changestatus(' + property.id + ', 0)">Disapprove</button>';
      } else {
        // Neither approved nor disapproved
        approveButtonHTML = '<button class="delvr-button" onclick="changestatus(' + property.id + ', 1)">Approve</button>';
        disapproveButtonHTML = '<button class="nondelvr-button" onclick="changestatus(' + property.id + ', 0)">Disapprove</button>';
      }
      const container = document.getElementById('property-listings')
      const mapURL = `https://maps.google.com/maps?q=${property.city},${property.state}&t=&z=13&ie=UTF8&iwloc=&output=embed`;
      let imageGalleryHTML = '<div class="col-md-12 mb-3"><h6>Property Images:</h6><div class="img-gallery-magnific">';
      property.images.forEach((image, index) => {
        imageGalleryHTML += `
            <div class="magnific-img">
                <a class="image-popup-vertical-fit" href=${image} title="${index + 1}.jpg">
                    <img src=${image} alt="${index + 1}.jpg" />
                </a>
            </div>`;
      });
      imageGalleryHTML += '</div></div>';
      container.innerHTML += imageGalleryHTML + `
 

                      <div class="col-md-12">
                        <!-- <div class="pr-div">
                          <h3>Priyansh Anjane</h3>
                        </div> -->

                        <div class="reg">
                          <div class="table-responsive">
                            <table class="table table-striped table-bordered">
                              <tbody>
                                <tr>
                                  <th scope="row">Land Owner Name</th>
                                  <td>${property.ownerName}</td>
                                </tr>
                                <tr>
                                  <th scope="row">Contact No.</th>
                                  <td>${property.mobile_number}</td>
                                </tr>
                                <tr>
                                  <th scope="row">Size of Land</th>
                                  <td>${property.size_of_land}</td>
                                </tr>
                                <tr>
                                  <th scope="row">Land Facing</th>
                                  <td>${property.Land_Facing}</td>
                                </tr>
                                <tr>
                                  <th scope="row">Survey Number</th>
                                  <td>${property.Survey_no}</td>
                                </tr>
                                <tr>
                                  <th scope="row">Landmark</th>
                                  <td>${property.landmark}</td>
                                </tr>
                                <tr>
                                  <th scope="row">Full Address</th>
                                  <td>
                                    ${property.full_address}.
                                  </td>
                                </tr>
                                <tr>
                                  <th scope="row">Type of Ownership</th>
                                  <td>${property.owenership}</td>
                                </tr>
                                <tr>
                                  <th scope="row">Land Price</th>
                                  <td>Rs ${property.landPrice}</td>
                                </tr>
                                <tr>
                                  <th scope="row">State</th>
                                  <td>${property.state}</td>
                                </tr>
                                <tr>
                                  <th scope="row">City</th>
                                  <td>${property.city}</td>
                                </tr>
                               
                                <tr>
                                  <th scope="row">Pincode</th>
                                  <td>${property.pincode}</td>
                                </tr>
                                <tr>
                                  <th scope="row">Latest Encumbrance</th>
                                  <td>${latestEncumbranceHtml}</td>
                                </tr>
                                <tr>
                                  <th scope="row">Khata Extract</th>
                                  <td>${latestKhata_Extract}</td>
                                </tr>
                              <tr>
                                  <th scope="row">Location in map</th>
                                  <td>
                                    <div style="width: 70%; padding: 10px">
                                      <iframe src="${mapURL}" frameborder="0" scrolling="no"></iframe>
                    <style>.mapouter{position:relative;width:100%;}.gmap_canvas{overflow:hidden;width:100%;}.gmap_canvas iframe{position:relative;z-index:2}.gmap_canvas a{top:0;z-index:0}</style>
                    <a href="https://www.eireportingonline.com"></a>
                                    </div>
                                  </td>
                                </tr>
                              </tbody>
                            </table>
                          </div>
                          </div>
                          ${approveButtonHTML}
        ${disapproveButtonHTML}
      
                  <button class="nondelvr-button" onclick="deleteElement(${property.id},${property.user_id})" style="background-color: red;">Delete</button>
                      </div>

                   
      `

      $('.image-popup-vertical-fit').magnificPopup({
        type: 'image',
        gallery: {
          enabled: true
        }
      });
      return container;
    }

    window.onload = displayPropertyDetails;
    $.ajax({
      url: apiUrl + '/getadmin', // Replace with your API endpoint
      type: 'GET',
      dataType: 'json',
      success: function (data) {

        $('#nameshow').text(data.message.name);
        $('#name').val(data.message.name);
        $('#email').val(data.message.email);
        $('#userid').val(data.message.User_ID);
        $('#password').val(data.message.password);
        $('#pass1').val(data.message.password);
        $('#id').val(data.message.id);
        var imgSrc = data.message.profile_image;
        $('#blah').attr('src', imgSrc);
        $('#blah1').attr('src', imgSrc);
      },
      error: function (error) {
        console.error('Error fetching data:', error);
      }
    });

    function openMyProfile() {
      // You can use window.location.href to navigate to a new page
      window.location.href = "my-profile.html";
    }
  </script>

</body>

</html>